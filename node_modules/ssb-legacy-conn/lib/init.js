"use strict";
const pull = require('pull-stream');
const ref = require('ssb-ref');
module.exports = function (gossip, config, server) {
    if (config.offline)
        return void console.log('Running in offline mode: gossip disabled');
    var seeds = config.seeds;
    (Array.isArray(seeds) ? seeds : [seeds])
        .filter(Boolean)
        .forEach(function (addr) {
        gossip.add(addr, 'seed');
    });
    if (!config.gossip ||
        (config.gossip.autoPopulate !== false && config.gossip.pub !== false))
        pull(server.messagesByType({
            type: 'pub',
            live: true,
            keys: false,
        }), pull.drain(function (msg) {
            if (msg.sync)
                return;
            if (!msg.content.address)
                return;
            if (ref.isAddress(msg.content.address))
                gossip.add(msg.content.address, 'pub');
        }, function () {
            console.warn('[gossip] warning: this can happen if the database closes', arguments);
        }));
    return;
};
