const test = require('tape')
const Reduce = require('../index')

const Strategy = require('@tangle/strategy')
const Overwrite = require('@tangle/overwrite')

const strategy = new Strategy({
  title: Overwrite()
})

test('opts.getBacklinks', t => {
  //   A   (root)
  //   |
  //   B

  const A = {
    key: 'A',
    tangles: {
      conversation: [null, null]
    },
    title: { set: 'my root message' }
  }
  const B = {
    key: 'B',
    tangles: {
      conversation: ['A', ['A']]
    },
    title: { set: 'nice nice' }
  }

  const getBacklinks = node => {
    return node.tangles.conversation[1]
  }

  const reduce = new Reduce(strategy, { nodes: [A, B], getBacklinks })
  t.deepEqual(
    reduce.state,
    {
      B: {
        title: { set: 'nice nice' }
      }
    },
    'custom getBacklinks works'
  )

  t.end()
})
